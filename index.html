<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz with AI</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />
  <style>
    body {
      background-color: #ffffff;
      color: #000000;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .btn-red {
      background-color: #ff4d4d;
      color: #ffffff;
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      font-weight: bold;
    }

    .btn-red:hover {
      background-color: #e60000;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
    }

    .btn-outline-dark {
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.3s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .btn-outline-dark:hover {
      background-color: #000;
      color: #fff;
      transform: scale(1.02);
    }

    .card {
      border: none;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      transition: box-shadow 0.3s ease;
    }

    .card:hover {
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.15);
    }

    video {
      max-width: 100%;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="app" class="container mt-5">
    <!-- Startsk√§rm -->
    <div v-if="!started && !quizEnded" class="text-center">
      <h1>{{ title }}</h1>
      <p>Press the button to start the test.</p>
      <button class="btn btn-red" @click="startQuiz">Start the test</button>
    </div>

    <!-- Quiz-sida -->
    <div v-if="started && !quizEnded" class="card p-4">
      <h4>Fr√•ga {{ currentIndex + 1 }} av {{ questions.length }}</h4>
      <h3 class="my-3">{{ currentQuestion.question }}</h3>

      <video v-if="currentQuestion.videoUrl" controls>
        <source :src="currentQuestion.videoUrl" type="video/mp4">
        Din webbl√§sare st√∂djer inte video.
      </video>

      <div v-for="(answer, index) in currentQuestion.answers" :key="index">
        <button
          class="btn btn-outline-dark w-100 mb-2"
          @click="selectAnswer(answer)"
          :disabled="answered"
        >
          {{ answer }}
        </button>
      </div>
    </div>

    <!-- Resultatsida -->
    <div v-if="quizEnded" class="text-center">
      <h2>The quiz is complete!</h2>
      <p>You got {{ score }} of {{ questions.length }} right.</p>

      <div class="mt-4 p-3 border rounded" style="background-color: #f8f9fa;">
        <h4>Score comparison</h4>
        <p>You: <strong>{{ score }}</strong></p>
        <p>ü§ñ AI: <strong>{{ aiScore }}</strong></p>
        <p v-if="score > aiScore" class="text-success">Congratulations! You beat the AI! üèÜ</p>
        <p v-else-if="score < aiScore" class="text-danger">The AI ‚Äã‚Äãwon this time... ü§ñüèÜ</p>
        <p v-else class="text-warning">Draw! Well played! üòÑ</p>
      </div>

      <button class="btn btn-red mt-4" @click="restartQuiz">Play again</button>
    </div>
  </div>

  <!-- Vue.js -->
  <script src="https://unpkg.com/vue@3"></script>

  <!-- Dummy AI-logik -->
  <script>
    window.getAIAnswer = function (question) {
      const difficultyChances = {
        easy: 0.9,
        medium: 0.7,
        hard: 0.5
      };

      let baseChance = difficultyChances[question.difficulty] || 0.6;

      if (question.isVideo && question.metadata?.EF !== undefined) {
        const ef = question.metadata.EF;

        let predictedClass = '';
        if (ef < 40) {
          predictedClass = 'Reducerat';
          baseChance += 0.15;
        } else if (ef >= 40 && ef < 50) {
          predictedClass = 'Abnormal';
          baseChance += 0.1;
        } else {
          predictedClass = 'Normal';
          baseChance += 0.1;
        }

        if (question.answers.includes(predictedClass)) {
          const willBeCorrect = Math.random() < baseChance;
          if (willBeCorrect) {
            return predictedClass;
          } else {
            const wrongAnswers = question.answers.filter(opt => opt !== predictedClass);
            return wrongAnswers[Math.floor(Math.random() * wrongAnswers.length)];
          }
        }
      }

      const willBeCorrect = Math.random() < baseChance;
      if (willBeCorrect) {
        return question.correct;
      } else {
        const wrongAnswers = question.answers.filter(opt => opt !== question.correct);
        return wrongAnswers[Math.floor(Math.random() * wrongAnswers.length)];
      }
    };
  </script>

  <!-- App Script -->
  <script>
    const app = Vue.createApp({
      data() {
        return {
          title: "Welcome to the Quiz!",
          started: false,
          quizEnded: false,
          currentIndex: 0,
          score: 0,
          aiScore: 0,
          selectedAnswers: [],
          answered: false,
          questions: [
            {
              question: "Vad √§r ungef√§rlig EF f√∂r detta hj√§rtslag?",
              videoUrl: "mp4vid/0X1B00A1770ABC7BD2.mp4",
              answers: ["Normal", "Abnormal", "Reducerat"],
              correct: "Reducerat",
              difficulty: "medium"
            },
            {
              question: "Vad √§r ungef√§rlig EF i videon?",
              videoUrl: "mp4vid/0X1000ABCD1234EFGH.mp4",
              answers: ["Normal", "Abnormal", "Reducerat"],
              correct: "Normal",
              difficulty: "easy"
            },
            {
              question: "Vad √§r ungef√§rlig EF i videon?",
              videoUrl: "mp4vid/0X2A6A2DB28C7B4608.mp4",
              answers: ["Normal", "Abnormal", "Reducerat"],
              correct: "Normal",
              difficulty: "hard"
            },
            {
              question: "Vad √§r ungef√§rlig EF i videon?",
              videoUrl: "mp4vid/0X5515B0BD077BE68A.mp4",
              answers: ["Normal", "Abnormal", "Reducerat"],
              correct: "Abnormal",
              difficulty: "medium"
            },
            {
              question: "Vad √§r ungef√§rlig EF i videon?",
              videoUrl: "mp4vid/0XFDB874C30A9C923.mp4",
              answers: ["Normal", "Abnormal", "Reducerat"],
              correct: "Reducerat",
              difficulty: "easy"
            }
          ]
        };
      },
      computed: {
        currentQuestion() {
          return this.questions[this.currentIndex];
        }
      },
      methods: {
        startQuiz() {
          this.started = true;
          this.quizEnded = false;
          this.currentIndex = 0;
          this.score = 0;
          this.aiScore = 0;
          this.selectedAnswers = [];
          this.answered = false;
        },
        selectAnswer(answer) {
          if (this.answered) return;
          this.answered = true;

          this.selectedAnswers.push({
            question: this.currentQuestion.question,
            selected: answer,
            correct: this.currentQuestion.correct
          });

          setTimeout(() => {
            this.answered = false;
            if (this.currentIndex < this.questions.length - 1) {
              this.currentIndex++;
            } else {
              this.endQuiz();
            }
          }, 500);
        },
        endQuiz() {
          this.started = false;
          this.quizEnded = true;

          this.score = this.selectedAnswers.filter(
            (a) => a.selected === a.correct
          ).length;

          let aiCorrect = 0;
          this.questions.forEach((q) => {
            const aiAnswer = getAIAnswer({
              question: q.question,
              answers: q.answers,
              correct: q.correct,
              difficulty: q.difficulty || "medium",
              isVideo: !!q.videoUrl,
              metadata: {
                EF:
                  q.correct === "Normal"
                    ? 55
                    : q.correct === "Abnormal"
                    ? 45
                    : q.correct === "Reducerat"
                    ? 30
                    : undefined
              }
            });
            if (aiAnswer === q.correct) {
              aiCorrect++;
            }
          });
          this.aiScore = aiCorrect;
        },
        restartQuiz() {
          this.startQuiz();
        }
      }
    });

    app.mount("#app");
  </script>
</body>
</html>
